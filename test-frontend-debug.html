<!DOCTYPE html>
<html>
<head>
    <title>Debug Frontend Room Listing</title>
    <script src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
</head>
<body>
    <h1>Debug Frontend Room Listing</h1>
    <div id="status">Connecting...</div>
    <div id="debug"></div>
    <div id="rooms"></div>
    
    <script>
        async function debugFrontend() {
            const statusDiv = document.getElementById('status');
            const debugDiv = document.getElementById('debug');
            const roomsDiv = document.getElementById('rooms');
            
            try {
                statusDiv.innerHTML = 'Connecting to lobby...';
                
                const client = new Colyseus.Client('ws://localhost:3002');
                const lobby = await client.joinOrCreate('lobby');
                
                statusDiv.innerHTML = 'Connected! Listening for rooms...';
                
                // Simulate the frontend filtering logic
                const selectedGameId = 'the-battle'; // This is what should be set in your frontend
                
                // Listen for room updates
                lobby.onMessage('rooms_updated', (data) => {
                    console.log('üîç Raw rooms_updated data:', data);
                    
                    debugDiv.innerHTML = `
                        <h3>Debug Info:</h3>
                        <p>Selected Game ID: <strong>${selectedGameId}</strong></p>
                        <p>Total rooms received: <strong>${data.activeRooms?.length || 0}</strong></p>
                    `;
                    
                    let html = '<h2>All Rooms (Raw):</h2>';
                    if (data.activeRooms && data.activeRooms.length > 0) {
                        data.activeRooms.forEach(room => {
                            html += `<div style="margin: 5px 0; padding: 5px; border: 1px solid #ccc;">
                                Room: ${room.roomCode}<br>
                                Name: "${room.roomName}"<br>
                                Game: <strong>${room.gameId}</strong><br>
                                Private: ${room.isPrivate}<br>
                                Players: ${room.playerCount}/${room.maxPlayers}
                            </div>`;
                        });
                        
                        // Apply the same filtering logic as the frontend
                        const filteredRooms = data.activeRooms.filter(r => r.gameId === selectedGameId);
                        
                        html += '<h2>Filtered Rooms (for the-battle):</h2>';
                        if (filteredRooms.length > 0) {
                            filteredRooms.forEach(room => {
                                html += `<div style="margin: 5px 0; padding: 5px; border: 2px solid green;">
                                    ‚úÖ Room: ${room.roomCode}<br>
                                    Name: "${room.roomName}"<br>
                                    Game: <strong>${room.gameId}</strong><br>
                                    Private: ${room.isPrivate}<br>
                                    Players: ${room.playerCount}/${room.maxPlayers}
                                </div>`;
                            });
                        } else {
                            html += '<div style="color: red;">‚ùå No rooms match the selected game ID</div>';
                        }
                    } else {
                        html += '<div>No rooms found</div>';
                    }
                    
                    roomsDiv.innerHTML = html;
                });
                
                // Request room refresh (like the frontend does)
                console.log('üîÑ Requesting room refresh...');
                lobby.send('refresh_rooms');
                
            } catch (error) {
                statusDiv.innerHTML = 'Error: ' + error.message;
                console.error('Error:', error);
            }
        }
        
        debugFrontend();
    </script>
</body>
</html>